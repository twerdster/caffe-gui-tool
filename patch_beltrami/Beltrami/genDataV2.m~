%% Setup
trainPath = '400_IMGS/';
testPath = '68_IMGS/';
sigma = 25;
patchSize = 64;
chans = 1;

%% Get training images
clean = [];
path = trainPath;
d = dir([path '*.png']);

for i=1:length(d)
    file = [path d(i).name];
    img = double(imread(file));
    patches = createPatches(img,[patchSize patchSize], true);

    fprintf('Size:%f\n',size(img,1));
    clean = cat(4,clean,patches);
    imshow(img/255);
    
    drawnow
end
clean = single(clean);

%% Noisify
randn('seed', 0);
noisy = clean + sigma*randn(size(clean));
% noisy = double(uint8(noisy));

%% Shuffle data
randn('seed', 0);
shuffle_idx = randperm(size(clean,4));
clean = clean(:,:,:,shuffle_idx);
noisy = noisy(:,:,:,shuf

% Setup files
delete DataTrain.h5
h5create('DataTrain.h5', '/data',  [patchSize,patchSize,chans,inf], 'Chunksize',[patchSize patchSize chans 1], 'Datatype', 'single');
h5create('DataTrain.h5', '/label', [patchSize,patchSize,chans,inf], 'Chunksize',[patchSize patchSize chans 1], 'Datatype', 'single');

for i=1:length(names)

            h5write(fname, '/data',   d ,[1 1 1 cnt],[patchSize patchSize 3 1]);
            h5write(fname, '/label', gt ,[1 1 1 cnt],[patchSize patchSize 3 1]);
                        
        end
    end
end

fprintf('train: %i, test: %i\n',cntTrain, cntTest);







